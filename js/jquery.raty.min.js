/*!
 * jQuery Raty - A Star Rating Plugin - http://wbotelhos.com/raty
 * 
 * @author  Washington Botelho
 * @twitter wbotelhos
 * @version 1.4.3
 * 
 * Licensed under The MIT License
 * http://opensource.org/licenses/mit-license.php
 * 
 */

(function(e){e.fn.raty=function(s){if(this.length==0){a("Selector invalid or missing!");return;}else{if(this.length>1){return this.each(function(){e.fn.raty.apply(e(this),[s]);});}}var o=e.extend({},e.fn.raty.defaults,s),w=e(this),l=w.attr("id"),n=(o.width)?o.width:(o.number*o.size+o.number*4);if(l===undefined||l==""){l="raty-"+w.index();w.attr("id",l);}w.data("options",o);if(o.number>20){o.number=20;}else{if(o.number<0){o.number=0;}}if(o.path.substring(o.path.length-1,o.path.length)!="/"){o.path+="/";}var q=!isNaN(parseInt(o.start,10))&&o.start>0,m=0;if(q){m=(o.start>o.number)?o.number:o.start;}var x=o.starOn,t="";for(var u=1;u<=o.number;u++){x=(m<u)?o.starOff:o.starOn;t=(u<=o.hintList.length&&o.hintList[u-1]!==null)?o.hintList[u-1]:u;w.append('<img id="'+l+"-"+u+'" src="'+o.path+x+'" alt="'+u+'" title="'+t+'" class="'+l+'"/>').append((u<o.number)?"&nbsp;":"");}if(o.iconRange&&q){b(w,m);}var r=e("<input/>",{id:l+"-score",type:"hidden",name:o.scoreName}).appendTo(w);if(q){r.val(m);}if(o.half){c(w,r.val());}if(!o.readOnly){var v=o.target;if(v!==null){v=e(v);if(v.length==0){a(l+": target selector invalid or missing!");}}if(o.cancel){var p=w.children("img."+l),y='<img src="'+o.path+o.cancelOff+'" alt="x" title="'+o.cancelHint+'" class="button-cancel"/>';if(o.cancelPlace=="left"){w.prepend(y+"&nbsp;");}else{w.append("&nbsp;").append(y);}w.children("img.button-cancel").mouseenter(function(){e(this).attr("src",o.path+o.cancelOn);p.attr("src",o.path+o.starOff);d(v,"",o);}).mouseleave(function(){e(this).attr("src",o.path+o.cancelOff);w.mouseout();}).click(function(z){r.removeAttr("value");if(o.click){o.click.apply(w,[null,z]);}});w.css("width",n+o.size+4);}else{w.css("width",n);}w.css("cursor","pointer");h(w,o,v);}else{w.css("cursor","default");k(w,m);}return w;};function h(m,l,p){var q=m.attr("id"),n=e("input#"+q+"-score"),o=m.children("img."+q);m.mouseleave(function(){g(m,n.val());f(p,n,l);});o.bind(((l.half)?"mousemove":"mouseover"),function(s){b(m,this.alt);if(l.half){var r=parseFloat(((s.pageX-e(this).offset().left)/l.size).toFixed(1));r=(r>=0&&r<0.5)?0.5:1;m.data("score",parseFloat(this.alt)+r-1);c(m,m.data("score"));}else{b(m,this.alt);}d(p,this.alt,l);}).click(function(r){n.val(l.half?m.data("score"):this.alt);if(l.click){l.click.apply(m,[n.val(),r]);}});}function f(n,o,l){if(n!==null){var m="";if(l.targetKeep){m=o.val();if(l.targetType=="hint"){if(o.val()==""&&l.cancel){m=l.cancelHint;}else{m=l.hintList[Math.ceil(o.val())-1];}}}if(i(n)){n.val(m);}else{n.html(m);}}}function b(m,o){var n=m.data("options"),l=m.attr("id"),p=m.children("img."+l).length,u=0,s=0,t,q;for(var r=1;r<=p;r++){t=m.children("img#"+l+"-"+r);if(r<=o){if(n.iconRange&&n.iconRange.length>u){q=n.iconRange[u][0];s=n.iconRange[u][1];if(r<=s){t.attr("src",n.path+q);}if(r==s){u++;}}else{t.attr("src",n.path+n.starOn);}}else{t.attr("src",n.path+n.starOff);}}}function k(m,o){var l=m.data("options"),n="";if(o!=0){o=parseInt(o,10);n=(o>0&&l.number<=l.hintList.length&&l.hintList[o-1]!==null)?l.hintList[o-1]:o;}else{n=l.noRatedMsg;}m.attr("title",n).children("img").attr("title",n);}function i(l){return l.is("input")||l.is("select")||l.is("textarea");}function g(m,n){var l=m.data("options"),o=m.attr("id");if(isNaN(parseInt(n,10))){m.children("img."+o).attr("src",l.path+l.starOff);e("input#"+o+"-score").removeAttr("value");return;}if(n<0){n=0;}else{if(n>l.number){n=l.number;}}b(m,n);if(n>0){e("input#"+o+"-score").val(n);if(l.half){c(m,n);}}if(l.readOnly||m.css("cursor")=="default"){k(m,n);}}function d(o,n,l){if(o!==null){var m=n;if(l.targetType=="hint"){if(n==0&&l.cancel){m=l.cancelHint;}else{m=l.hintList[n-1];}}if(i(o)){o.val(m);}else{o.html(m);}}}function c(n,p){var m=n.data("options"),q=n.attr("id"),l=Math.ceil(p),o=(l-p).toFixed(1);if(o>0.25&&o<=0.75){l=l-0.5;e("img#"+q+"-"+Math.ceil(l)).attr("src",m.path+m.starHalf);}else{if(o>0.75){l--;}else{e("img#"+q+"-"+l).attr("src",m.path+m.starOn);}}}e.fn.raty.cancel=function(l,n){var m=(n===undefined)?false:true;if(m){return e.fn.raty.click("",l,"cancel");}else{return e.fn.raty.start("",l,"cancel");}};e.fn.raty.click=function(o,m){var n=j(o,m,"click");if(m.indexOf(".")>=0){return;}g(n,o);var l=e(m).data("options");if(l.click){l.click.apply(n,[o]);}else{a(m+': you must add the "click: function(score, evt) { }" callback.');}return n;};e.fn.raty.readOnly=function(o,m){var n=j(o,m,"readOnly");if(m.indexOf(".")>=0){return;}var p=n.children("img.button-cancel");if(p[0]){(o)?p.hide():p.show();}if(o){e("img."+n.attr("id")).unbind();n.css("cursor","default").unbind();}else{var l=e(m).data("options");h(n,l);n.css("cursor","pointer");}return n;};e.fn.raty.start=function(n,l){var m=j(n,l,"start");if(l.indexOf(".")>=0){return;}g(m,n);return m;};function j(p,m,l){var n=undefined;if(m==undefined){a("Specify an ID or class to be the target of the action.");return;}if(m){if(m.indexOf(".")>=0){var o;return e(m).each(function(){o="#"+e(this).attr("id");if(l=="start"){e.fn.raty.start(p,o);}else{if(l=="click"){e.fn.raty.click(p,o);}else{if(l=="readOnly"){e.fn.raty.readOnly(p,o);}}}});}n=e(m);if(!n.length){a('"'+m+'" is a invalid identifier for the public funtion $.fn.raty.'+l+"().");return;}}return n;}function a(l){if(window.console&&window.console.log){window.console.log(l);}}e.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,hintList:["bad","poor","regular","good","gorgeous"],noRatedMsg:"not rated yet",number:5,path:"img/",iconRange:[],readOnly:false,scoreName:"score",size:16,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,target:null,targetKeep:false,targetType:"hint",width:null};})(jQuery);